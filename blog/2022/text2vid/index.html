<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Building Blocks of Text-to-Video Generation | ICLR Blogposts 2023 (staging)</title> <meta name="author" content="abc b c"/> <meta name="description" content="Google's Imagen Video and Meta's Make-a-Video Explained"/> <meta name="keywords" content="machine-learning, ml, deep-learning, reinforcement-learning, iclr"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="/deep-learning-blog.github.io/assets/img/iclr_favicon.ico"/> <link rel="stylesheet" href="/deep-learning-blog.github.io/assets/css/main.css"> <link rel="canonical" href="https://jocelynshen.com/deep-learning-blog.github.io/blog/2022/text2vid/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/deep-learning-blog.github.io/assets/js/theme.js"></script> <script src="/deep-learning-blog.github.io/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/deep-learning-blog.github.io/assets/js/distillpub/template.v2.js"></script> <script src="/deep-learning-blog.github.io/assets/js/distillpub/transforms.v2.js"></script> <script src="/deep-learning-blog.github.io/assets/js/distillpub/overrides.js"></script> </head> <d-front-matter> <script async type="text/json">{
      "title": "Building Blocks of Text-to-Video Generation",
      "description": "Google's Imagen Video and Meta's Make-a-Video Explained",
      "published": "December 1, 2022",
      "authors": [
        {
          "author": "Anonymous",
          "authorURL": "",
          "affiliations": [
            {
              "name": "",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <body class="fixed-top-nav"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/deep-learning-blog.github.io/">ICLR Blogposts 2023 (staging)</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/deep-learning-blog.github.io/about">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/deep-learning-blog.github.io/call">call for blogposts</a> </li> <li class="nav-item "> <a class="nav-link" href="/deep-learning-blog.github.io/submitting">submitting</a> </li> <li class="nav-item "> <a class="nav-link" href="/deep-learning-blog.github.io/blog/index.html">blog</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">past iterations</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="https://iclr-blog-track.github.io/home/" target="_blank" rel="noopener noreferrer">2022</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="post distill"> <d-title> <h1>Building Blocks of Text-to-Video Generation</h1> <p>Google's Imagen Video and Meta's Make-a-Video Explained</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#google-s-imagen-video-and-meta-s-make-a-video-explained">Google's Imagen Video and Meta's Make-a-Video Explained</a></div> <div><a href="#history-of-text-to-video">History of Text-to-Video</a></div> <div><a href="#text-to-image-generation">Text-to-Image Generation</a></div> <ul> <li><a href="#what-is-latent-space">What is latent space?</a></li> <li><a href="#how-does-stable-diffusion-work-in-latent-space">How does stable diffusion work in latent space?</a></li> </ul> <div><a href="#text-to-video-generation">Text-to-Video Generation</a></div> <ul> <li><a href="#how-do-we-extend-text-to-image-to-text-to-video">How do we extend Text-to-Image to Text-to-Video?</a></li> <li><a href="#spatial-and-temporal-super-resolution">Spatial and Temporal Super Resolution</a></li> </ul> <div><a href="#conclusions">Conclusions</a></div> <ul> <li><a href="#putting-together-all-the-building-blocks">Putting Together All The Building Blocks</a></li> <li><a href="#limitations-of-text-to-video">Limitations of Text-to-Video</a></li> </ul> <div><a href="#related-works">Related Works</a></div> <div><a href="#references">References</a></div> </nav> </d-contents> <h1 id="googles-imagen-video-and-metas-make-a-video-explained">Google’s Imagen Video and Meta’s Make-a-Video Explained</h1> <p> </p> <callout> Google and Meta have both developed advanced AI networks that can generate new, unseen videos using only simple text prompts. Try clicking through the prompts and compare the results between Google's Imagen Video and Meta's Make-a-Video models: </callout> <figure1> <iframe height="600px" width="840px" scrolling="No" frameborder="0" hspace="0" vspace="0" src="https://video-gui.onrender.com/"></iframe> </figure1> <p style="text-align: justify">In this post, we dissect and explain the mechanics behind the key building blocks for state-of-the-art Text-to-Video generation. We provide interactive examples of these building blocks and demonstrate the key novelties/differences between two Text-to-Video models: Imagen Video and Make-a-Video. Finally, we summarize by showing how the building blocks fit together into a complete Text-to-Video framework as well as noting the current failure modes and limitations of the models today.</p> <h1 id="history-of-text-to-video">History of Text-to-Video</h1> <p style="text-align: justify">Just six months after the release of DALL-E 2, both Meta and Google released novel Text-to-Video generation models that output impressive video-format content. These networks build off of recent advancements in Text-to-Image modeling using stable diffusion (like DALL-E <a href="https://arxiv.org/pdf/2102.12092" target="_blank" rel="noopener noreferrer">[1]</a> and Imagen <a href="https://arxiv.org/pdf/2205.11487" target="_blank" rel="noopener noreferrer">[2]</a>). Meta’s Make-A-Video <a href="https://arxiv.org/pdf/2209.14792" target="_blank" rel="noopener noreferrer">[3]</a> is capable of five second 768x768 clips at variable frame rates while Google’s Imagen Video <a href="https://arxiv.org/pdf/2210.02303" target="_blank" rel="noopener noreferrer">[4]</a> can produce 1280×768 videos at 24 fps. Rather than training strictly on text-video pair datasets, both Imagen Video and Make-a-Video leverage the massive text-image pair databases to construct video from pretrained Text-to-Image generation models. These Text-to-Video generators are capable of creating high-resolution, photorealistic and stylistic content of impossible scenarios. Networks such as these can be powerful tools for artists and creators as well as the basis for predicting future frames of a video.</p> <p style="text-align: justify">Video generation has progressed rapidly in the past decade. Early video generation models focused on simple, specific domains and next frame prediction with <strong>deterministic autoregressive</strong> methods (CDNA <a href="https://proceedings.neurips.cc/paper/2016/file/d9d4f495e875a2e075a1a4a6e1b9770f-Paper.pdf" target="_blank" rel="noopener noreferrer">[5]</a>, PredRNN <a href="https://papers.nips.cc/paper/2017/file/e5f6ad6ce374177eef023bf5d0c018b6-Paper.pdf" target="_blank" rel="noopener noreferrer">[6]</a>). Later video prediction models incorporated stochasticity (SV2P <a href="https://openreview.net/pdf?id=rk49Mg-CW" target="_blank" rel="noopener noreferrer">[7]</a>). Another line of work uses generative models, namely <strong>GANs</strong>, to synthesize complex scenes without a first frame (VGAN <a href="https://arxiv.org/pdf/1611.01799.pdf" target="_blank" rel="noopener noreferrer">[8]</a>, TGAN <a href="https://arxiv.org/pdf/1611.06624" target="_blank" rel="noopener noreferrer">[9]</a>). More recently, Text-to-Video has been approached with <strong>VQVAEs</strong> to learn latent representations of video frames and then <strong>autoregressive transformers</strong> to generate video samples (GODIVA <a href="https://arxiv.org/pdf/2104.14806" target="_blank" rel="noopener noreferrer">[10]</a>, NUWA <a href="https://arxiv.org/pdf/2111.12417" target="_blank" rel="noopener noreferrer">[11]</a>). This technique allows for open-domain video generation, but frames are still generated one at a time chronologically, resulting in potentially poor text-video alignment. CogVideo <a href="https://arxiv.org/pdf/2205.15868" target="_blank" rel="noopener noreferrer">[12]</a> adjusts the training procedure to fix alignment (discussed below) and uses pre-trained Text-to-Image weights. Make-A-Video and Imagen Video both use <strong>diffusion models</strong> (VDM <a href="https://openreview.net/pdf?id=2LdBqxc1Yv" target="_blank" rel="noopener noreferrer">[13]</a>), which we will discuss in the next section.</p> <p style="text-align: justify">Make-A-Video and Imagen Video have come out just six months after Open-AI’s DALL-E 2. Text-to-Video is a much harder problem than Text-to-Image because we don’t have access to as many labeled text-video pairs. Therefore, all the models we highlight take advantage of starting from an existing Text-to-Image model with pre-trained or frozen weights. Moreover, beyond just generating pixels, the network has to predict how they will all evolve over time to coherently complete any actions in the text prompt.</p> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/timeline1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/timeline1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/timeline1-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/timeline1.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Figure 1. Timeline of video generation and prediction techniques. The modern-day Text-to-Video generators each leverage the capabilities of massively pre-trained Text-to-Image networks, such as Imagen and DALL-E 2. </div> <p> </p> <p style="text-align: justify">We’ll break down the building blocks to make Text-to-Video generation possible, starting from a brief overview of how Text-to-Image generators use stable diffusion, how to make the components 3D to incorporate temporal information for video generation, and how to increase the spatial and temporal resolution. We focus on how these components make up Make-A-Video and Imagen Video, but also touch on CogVideo (an open-source Text-to-Image video generator that uses a VQVAE + autoregressive transformers architecture).</p> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/T2V1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/T2V1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/T2V1-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/T2V1.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Figure 2. A simplified foundational network diagram for Text-to-Video generation that leverages pretrained Text-to-Image encodings. These encodings are trained to be decoded into image "batches", e.g., videos, that get upsampled spatially and temporally to have higher framerates and higher resolution. Scroll to Figure 9 to see the building blocks in more detail and how they fit together. </div> <p> </p> <h1 id="text-to-image-generation">Text-to-Image Generation</h1> <h2 id="what-is-latent-space">What is latent space?</h2> <p style="text-align: justify">Text-to-Image generation uses stable diffusion in latent space and a 2D U-Net architecture for image generation (see link for more details). First let’s explain how <strong>auto-encoders</strong> work:</p> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/autoencoder1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/autoencoder1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/autoencoder1-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/autoencoder1.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Figure 3. Demonstration of an autoencoder network. Images get compressed into lower-dimensional embeddings that are later decoded and "reconstructed." Training this autoencoder network learns weights for the decoder, such that when randomly sampled embeddings from Z are passed through the decoder, D, brand new images unseen by the network are generated. </div> <p> </p> <p style="text-align: justify">Here an input image is encoded into a lower-dimensional latent space representation and a decoder can reconstruct the image. This network is trained on the <a href="https://cs.nyu.edu/~roweis/data.html" target="_blank" rel="noopener noreferrer">Frey Faces Dataset</a> by comparing the input to the reconstructed output. Sampling within the latent space distribution allows us to generate realistic outputs.</p> <p> </p> <callout> Try it out yourself! We’ve trained an autoencoder with a two-dimensional latent space embedding. The two latents happen to correspond to expression and pose (the two variables changed in the dataset). Slowly Drag your cursor through latent space to change the values of the latent variable, Z, and see how the reconstructed image from the decoder changes (dragging too quickly will buffer image generation): </callout> <figure> <iframe height="420px" width="720px" scrolling="No" frameborder="0" hspace="0" vspace="0" src="https://vae-gui.onrender.com/"></iframe> </figure> <p style="text-align: justify">For Text-to-Video generation, the encoding-decoding network is trained using <strong>stable diffusion</strong> <a href="https://openaccess.thecvf.com/content/CVPR2022/papers/Rombach_High-Resolution_Image_Synthesis_With_Latent_Diffusion_Models_CVPR_2022_paper.pdf" target="_blank" rel="noopener noreferrer">[15]</a>.</p> <h2 id="how-does-stable-diffusion-work-in-latent-space">How does stable diffusion work in latent space?</h2> <p style="text-align: justify">During the forward process, we create a dataset by incrementally adding more noise to our latent variables. In the reverse process, we train a model with a <strong>U-Net architecture</strong> <a href="https://arxiv.org/pdf/1505.04597" target="_blank" rel="noopener noreferrer">[16]</a> to iteratively denoise these latents. This way, we can efficiently generate new images by starting with random noise and end up with a latent that can be decoded into a real image (while conditioning layers on the input text embedding).</p> <p> </p> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/latents1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/latents1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/latents1-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/latents1.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Figure 4. Forward and reverse processes in stable diffusion. In the forward process, random noise is progressively added to the latents in order to create a training set. In the reverse process, the noisy latents are iteratively passed through a U-Net model that learns to denoise the latents. Thus, we can pass random noise into this model and generate a new relevant video with the model’s attention layers conditioned to the input. </div> <p> </p> <p style="text-align: justify">The U-Net architecture (which we use as a noise detector) is an <strong>autoencoder</strong>. Downsampling and upsampling is done with convolutional layers. However, because the latent space is lower-dimensional, it’s possible to lose information, meaning that spatial recreation can be imprecise during upsampling. To deal with this, U-Net has <strong>skip connections</strong> that transfer information across the network, bypassing the downsampling and compression.</p> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/unet2-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/unet2-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/unet2-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/unet2.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Figure 5. U-Net architecture consists of a convolutional encoder and decoder. Skip connections copy and crop information from downsampling. Attention layers at skip connections help by weighting relevant information. Referenced from U-Net [16]. </div> <p> </p> <p style="text-align: justify">However, the poor feature representation in the initial layers result in redundant information. To deal with this, we can add <strong>attention layers</strong> at the skip connections to suppress activation in irrelevant regions, reducing the number of redundant features brought across by focusing “attention” only on the most important image features. For Text-to-Image generation, these attention networks also have access to the text embeddings to help condition the attention.</p> <p> </p> <callout> Try it out yourself! Click on different points in the first image and see how this would change the weights in the attention layer. The attention highlights similar features to the clicked region. For Text-to-Image and Text-to-Video generation, we include text embeddings to condition attention: </callout> <figure> <iframe height="400px" width="600px" scrolling="No" frameborder="0" hspace="0" vspace="0" src="https://attn-gui.onrender.com/"></iframe> </figure> <p>In the next section we discuss how to modify our convolutional and attention layers to move from image <em>(2D spatial)</em> representations to video <em>(3D)</em> representations, composed of individual frames <em>(2D spatial)</em> + time <em>(1D temporal)</em>.</p> <h1 id="text-to-video-generation">Text-to-Video Generation</h1> <h2 id="how-do-we-extend-text-to-image-to-text-to-video">How do we extend Text-to-Image to Text-to-Video?</h2> <p style="text-align: justify">Text-to-Image generation uses U-Net architecture with 2D spatial convolution and attention layers. For video generation, we need to add a third temporal dimension to the two spatial ones. 3D convolution layers are computationally expensive and 3D attention layers are computationally intractable. Therefore, these papers have their own approaches.</p> <p style="text-align: justify">Make-A-Video creates pseudo 3D convolution and attention layers by stacking a 1D temporal layer over a 2D spatial layer. Imagen Video does spatial convolution and attention for each individual frame, then does temporal attention or convolution across all frames.</p> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/attention1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/attention1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/attention1-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/attention1.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Figure 6. 3D U-Net components stacking 1D temporal layers over 2D spatial layers. Make-A-Video has individual pseudo 3D convolutional and attention layers. Imagen video first does spatial processing on each individual frame and then has a temporal attention layer across frames. The spatial layers can all be pre-trained from Text-to-Image models. </div> <p> </p> <p>Separating the spatial and temporal operations allows for <strong>building off of existing Text-to-Image models.</strong></p> <ul style="text-align: justify"> <li> <strong>CogVideo</strong> freezes all the weights of the spatial layers</li> <li> <strong>Make-A-Video</strong> uses pretrained weights for the spatial layers but initializes the temporal layer weights to the identity matrix. This way they can continue tuning all weights with new video data</li> <li> <strong>Imagen Video</strong> can jointly train their model with video and image data, doing the latter by masking the temporal connections</li> </ul> <h2 id="spatial-and-temporal-super-resolution">Spatial and Temporal Super Resolution</h2> <p style="text-align: justify">The base video decoder creates a fixed number of frames (5 frames for CogVideo, 16 frames for Make-A-Video, and 15 frames for Imagen Video) that need to be upsampled temporally and spatially.</p> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/super_resolution1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/super_resolution1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/super_resolution1-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/super_resolution1.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Figure 7. Text-to-Video architectures of Imagen Video (top) and Make-A-Video (bottom). Light blue boxes represent temporal upsampling steps and darker blue boxes are for spatial upsampling. </div> <p> </p> <p style="text-align: justify">Make-A-Video uses <strong>frame rate conditioning</strong>, meaning they have an additional input that determines the fps in the generated video (unlike how Imagen Video has a fixed frame rate in each stage). During training, this is useful as a form of data augmentation due to the limited dataset of videos. CogVideo also highlights the importance of changing the frame rate in order to retime videos such that an entire action can be encompassed in a fixed video length. For example the action “drinking” is composed of the sub-actions “pick up glass,” “drink,” and “place glass” which need to be performed in that order. If training on videos of a fixed length, changing the frame rate can help ensure text-video alignment.</p> <p style="text-align: justify"><strong>Frame interpolation</strong> for Make-A-Video is done in an autoregressive manner. They fine-tune a spatio-temporal decoder by masking certain frames of a training video and learning to predict them. They train with variable frame-skips and fps conditioning to enable different temporal upsampling rates. The framework is also able to interpolate and extrapolate (extend the beginning or end of a video).</p> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/masking2-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/masking2-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/masking2-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/masking2.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Figure 8. Frame masking for frame interpolation (middle) and extrapolation (bottom). For interpolation, variable frames are skipped. For extrapolation, frames at the beginning or end of the video can be masked. </div> <p> </p> <p style="text-align: justify">Imagen Video’s approach relies on <strong>cascaded video diffusion models</strong>. They generate entire blocks of frames simultaneously for each network to avoid the artifacts that would result from running super-resolution on independent frames. Each of the 6 super-resolution sub-models after the base video diffusion model, shown in <em>Figure 7 (top)</em>, focuses on either temporal or spatial upsampling. While the base model (the video decoder at the lowest frame rate/resolution) uses a temporal attention layer to model long-term temporal dependencies, the super-resolution models only use temporal convolution layers for computational efficiency while still maintaining local temporal consistency. Similarly, spatial attention is only used in the base and first two spatial super-resolution models, while the rest only use convolution.</p> <p style="text-align: justify">Make-A-Video’s approach initially interpolates frames and then increases the spatial resolution with two super-resolution layers, shown in <em>Figure 7 (bottom)</em>. The first super-resolution layer operates across spatial and temporal dimensions. The second super-resolution layer only operates across the spatial dimension because of memory and space constraints. However, spatial upsampling requires <strong>detail hallucination</strong> which needs to be consistent across frames (hence the use of the temporal dimension in the previous layer). To deal with this, they use the same noise initialization for each frame to encourage consistent detail hallucination across frames.</p> <callout> Here we show a low-resolution video upsampled using bilinear interpolation (left) and the same video upsampled using a super-resolution neural networks applied to each individual frame (middle). We see flickering artifacts because upsampling was performed separately per frame, rather than hallucinating detail across frames. The difference map (right) highlights the differences between the left and middle videos to demonstrate the flickering effect that occurs in a video when upsampled without proper detail hallucination to maintain temporal coherency. The video generation models we discuss actively consider temporal coherency while hallucinating details during upsampling to avoid these artifacts </callout> <center> <video autoplay="" muted="" loop="" controls="" src="https://jocelynshen.com/deep-learning-blog.github.io/assets/video/2023-02-01-text2vid/artifacts_stack1.mp4" style="width:500px" type="video/mp4"> </video> <figcaption>(left) Video frames upsampled using bilinear interpolation. (middle) Video frames upsampled using a super-resolution neural network. (right) Difference map between each frame of the left and middle videos, showing flickering artifacts.</figcaption> </center> <p> </p> <h1 id="conclusions">Conclusions</h1> <h2 id="putting-together-all-the-building-blocks">Putting Together All The Building Blocks</h2> <p>In this post, we have described the foundational building blocks of Text-to-Video generation of two popular models, Google’s Imagen Video and Meta’s Make-a-Video. Although these two methods have various differences, they build off of similar theory and similar building blocks. In <em>Figure 9</em>, we visually demonstrate how each of the consituent building blocks discussed in this post fit together to construct the larger Text-to-Video model.</p> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/T2V_building_blocks3-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/T2V_building_blocks3-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/T2V_building_blocks3-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-01-text2vid/T2V_building_blocks3.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Figure 9. The building blocks of Text-to-Video generation. </div> <p> </p> <p>The foundational building blocks of <em>Figure 9</em> and their utility in Text-to-Video generation are summarized:</p> <ol> <li> <strong>Latent Decoder:</strong> An autoencoder encoding-decoding network demonstrates how data can be compressed into a low-dimensional latent representation and then by selecting different points in this latent space, new outputs are generated.</li> <li> <strong>Latent Diffusion:</strong> Training an encoding-decoding network with the stable diffusion process allows completely new images to be generated from latents with added noise. In a Text-to-Video model, image “batches” are generated from a single noisy latent put through the trained decoder to create a new, unseen video at low FPS and low resolution.</li> <li> <strong>2D U-Net:</strong> To retain import information during the latent space compression encoding-decoding process, skip connections are added to tether the encoder with the decoder. This is a data-efficient architecture called a U-Net that is used in the encoding-decoding process of Text-to-Image.</li> <li> <strong>3D U-Net:</strong> The 3D U-Net is an extension of the Text-to-Image 2D U-Net for Text-to-Video generation. Since it is computationally expensive to expand 2D convolution and attention directly into 3D, hence, psuedo 3D convolution and attention are constructed by concatenating 2D spatial and 1D temporal layers.</li> <li> <strong>Attention:</strong> Attention layers help determine which spatial and temporal features to pay attention to, according to the input text conditioning. In a Text-to-Video model, attention helps create realistic videos by connecting important features in each frame and across frames with less required information transfer than a standard fully-connected layer.</li> <li> <strong>Super-Resolution:</strong> Upsampling in both the spatial and temporal dimensions increases the video resolution and frame rate, respectively. In Text-to-Video, upsampling is done across image batches simultaneously or with other considerations to ensure temporal consistency.</li> </ol> <p>By combining these six building blocks together, a <strong>complete Text-to-Video generation model</strong> can be constructed. Google and Meta demonstrate technically unique yet methodically similar approaches for expanding 2D Text-to-Image generation into the 3D realm while significantly improving the resolution, framerate, and temporal coherency of videos generated from text-based prompts.</p> <h2 id="limitations-of-text-to-video">Limitations of Text-to-Video</h2> <p style="text-align: justify">As beautiful as many of these videos are . . .</p> <figure> <video autoplay="" muted="" loop="" controls="" src="https://imagen.research.google/video/hdvideos/51.mp4" width="600" type="video/mp4"> </video> </figure> <p> </p> <p style="text-align: justify">Not all of them are perfect . . . <em>(pay close attention to the legs of the elephant walking)</em></p> <figure> <video autoplay="" muted="" loop="" controls="" src="https://imagen.research.google/video/hdvideos/14.mp4" width="600" type="video/mp4"> </video> </figure> <p>Although Imagen Video and Make-a-Video have made significant progress in temporal coherency to remove flickering effects, complex videos generated where image data is sparse, have poor realism across the temporal dimension. In the elephant walking underwater example, a lack of training data of elephants walking or perhaps training sets with insufficient frame rates results in latent diffusion having to work harder to interpolate the missing frames, resulting in <strong>poor temporal realism</strong>. However, as both datasets and models continue to grow in size, the videos generated by the methods discussed in this post will improve in realism and these failure modes will become less common.</p> <p>Furthermore, both models are optimized for producing shorter (5-second) videos. Since Make-A-Video directly builds on Text-to-Image, it cannot learn associations that can only be learned from videos. Longer videos containing multiple scenes and actions are challenging to generate with both of these models.</p> <p style="text-align: justify">Undoubtedly, these Text-to-Video generation methods can substantially expand the creative toolbox available to artists and creators, however, key issues should be addressed before these networks become publicly available. For example, misuse of the models can result in fake, explicit, hateful, or otherwise generally <strong>harmful content</strong>. To help address this, additional classifiers can be trained to filter text inputs and video outputs. Moreover, the outputs reflect the composition of the training dataset, which include some problematic data, social biases, and stereotypes.</p> <h1 id="related-works">Related Works</h1> <p style="text-align: justify">Several advancements have been achieved with the methods described in this post, however, video generation is not a new concept, nor do the methods described in this post solve all video generation challenges. So, here is a selection of some other interesting video generation variations/applications developed by other researchers:</p> <ul> <li> <a href="https://phenaki.video/" target="_blank" rel="noopener noreferrer">Phenaki</a> is another video generation tool that can generate videos of several minutes in length from story-like text prompts, compared to 5 second videos generated by Imagen Video and Make-a-Video.</li> <li> <a href="https://kuai-lab.github.io/eccv2022sound/" target="_blank" rel="noopener noreferrer">Lee <em>et al.</em></a> and <a href="https://medhini.github.io/audio_video_textures/" target="_blank" rel="noopener noreferrer">Narashimhan <em>et al.</em></a> generated video synced with audio inputs.</li> <li> <a href="https://sites.google.com/view/visualforesight?pli=1" target="_blank" rel="noopener noreferrer">Visual Foresight</a> predicts how an object will move given an action in pixel space for more practical robotics planning and control applications.</li> </ul> <h1 id="references">References</h1> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/2102.12092" target="_blank" rel="noopener noreferrer">[1] Ramesh, A. et al. Zero-Shot Text-to-Image Generation, 2021. <em>arXiv Preprint</em>.</a></p> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/2205.11487" target="_blank" rel="noopener noreferrer">[2] Saharia, C. et al. Photorealistic Text-to-Image Diffusion Models with Deep Language Understanding, 2022. <em>arXiv Preprint</em>.</a></p> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/2209.14792" target="_blank" rel="noopener noreferrer">[3] Singer, U. et al. Make-a-Video: Text-to-Video Generation Without Text-Video Data, 2022. <em>arXiv Preprint</em>.</a></p> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/2210.02303" target="_blank" rel="noopener noreferrer">[4] Ho, J. et al. Imagen Video: High Definition Video Generation with Diffusion Models, 2022. <em>arXiv Preprint</em>.</a></p> <p style="font-size: smaller"><a href="https://proceedings.neurips.cc/paper/2016/file/d9d4f495e875a2e075a1a4a6e1b9770f-Paper.pdf" target="_blank" rel="noopener noreferrer">[5] Finn, C. et al. Unsupervised Learning for Physical Interaction through Video Prediction, 2016. <em>30th Conference on Neural Information Processing Systems (NeurIPS)</em>.</a></p> <p style="font-size: smaller"><a href="https://papers.nips.cc/paper/2017/file/e5f6ad6ce374177eef023bf5d0c018b6-Paper.pdf" target="_blank" rel="noopener noreferrer">[6] Wang, Y. et al. PredRNN: Recurrent Neural Networks for Predictive Learning using Spatiotemporal LSTMs, 2017. <em>30th Conference on Neural Information Processing Systems (NeurIPS)</em>.</a></p> <p style="font-size: smaller"><a href="https://openreview.net/pdf?id=rk49Mg-CW" target="_blank" rel="noopener noreferrer">[7] Babaeizadeh, M. et al. Stochastic Variational Video Prediction, 2018. <em>International Conference on Learning Representations (ICLR)</em>.</a></p> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/1611.01799.pdf" target="_blank" rel="noopener noreferrer">[8] Zhai, S. et al. Generative Adversarial Networks as Variational Training of Energy Based Models, 2017. <em>arXiv Preprint</em>.</a></p> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/1611.06624" target="_blank" rel="noopener noreferrer">[9] Saito, M. et al. Temporal Generative Adversarial Nets with Singular Value Clipping, 2016. <em>arXiv Preprint</em>.</a></p> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/2104.14806" target="_blank" rel="noopener noreferrer">[10] Wu, C. et al. GODIVA: Generating Open-DomaIn Videos from nAtural Descriptions, 2021. <em>arXiv Preprint</em>.</a></p> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/2111.12417" target="_blank" rel="noopener noreferrer">[11] Wu, C. et al. NÜWA: Visual Synthesis Pre-training for Neural visUal World creAtion, 2021. <em>arXiv Preprint</em>.</a></p> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/2205.15868" target="_blank" rel="noopener noreferrer">[12] Hong, W. et al. CogVideo: Large-scale Pretraining for Text-to-Video Generation via Transformers, 2022. <em>arXiv Preprint</em>.</a></p> <p style="font-size: smaller"><a href="https://openreview.net/pdf?id=2LdBqxc1Yv" target="_blank" rel="noopener noreferrer">[13] Kingma, D. P. et al. Variational Diffusion Models, 2021. <em>35th Conference on Neural Information Processing Systems (NeurIPS)</em>.</a></p> <p style="font-size: smaller"><a href="https://proceedings.neurips.cc/paper/2021/file/a4d92e2cd541fca87e4620aba658316d-Paper.pdf" target="_blank" rel="noopener noreferrer">[14] Ding, M. et al. CogView: Mastering Text-to-Image Generation via Transformers, 2021. <em>35th Conference on Neural Information Processing Systems (NeurIPS)</em>.</a></p> <p style="font-size: smaller"><a href="https://openaccess.thecvf.com/content/CVPR2022/papers/Rombach_High-Resolution_Image_Synthesis_With_Latent_Diffusion_Models_CVPR_2022_paper.pdf" target="_blank" rel="noopener noreferrer">[15] Rombach, R. et al. High-Resolution Image Synthesis with Latent Diffusion Models, 2022. <em>IEEE / CVF Computer Vision and Pattern Recognition Conference (CVPR)</em>.</a></p> <p style="font-size: smaller"><a href="https://arxiv.org/pdf/1505.04597" target="_blank" rel="noopener noreferrer">[16] Ronneberger, O. et al. U-Net: Convolutional Networks for Biomedical Image Segmentation, 2015. <em>arXiv Preprint</em>.</a></p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> </div> <d-bibliography src="/deep-learning-blog.github.io/assets/bibliography/"></d-bibliography> <script src="https://utteranc.es/client.js" repo="iclr-blogposts/2023" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> </body> </html>