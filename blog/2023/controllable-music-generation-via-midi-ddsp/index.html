<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Controllable Music Generation via MIDI-DDSP | ICLR Blogposts 2023 (staging)</title> <meta name="author" content="abc b c"/> <meta name="description" content="Recently, there has been a lot of fascinating work focusing on making music generation for a larger and more general audience. However, these models could be of great help to the artists if they can intervene into the generation process at multiple levels in order to control what notes are played and how they are performed. We hence dive deeper into MIDI-DDSP that helps with high-fidelity generations using an interpretable hierarchy with several degrees of granularity."/> <meta name="keywords" content="machine-learning, ml, deep-learning, reinforcement-learning, iclr"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="/deep-learning-blog.github.io/assets/img/iclr_favicon.ico"/> <link rel="stylesheet" href="/deep-learning-blog.github.io/assets/css/main.css"> <link rel="canonical" href="https://jocelynshen.com/deep-learning-blog.github.io/blog/2023/controllable-music-generation-via-midi-ddsp/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/deep-learning-blog.github.io/assets/js/theme.js"></script> <script src="/deep-learning-blog.github.io/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/deep-learning-blog.github.io/assets/js/distillpub/template.v2.js"></script> <script src="/deep-learning-blog.github.io/assets/js/distillpub/transforms.v2.js"></script> <script src="/deep-learning-blog.github.io/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <d-front-matter> <script async type="text/json">{
      "title": "Controllable Music Generation via MIDI-DDSP",
      "description": "Recently, there has been a lot of fascinating work focusing on making music generation for a larger and more general audience. However, these models could be of great help to the artists if they can intervene into the generation process at multiple levels in order to control what notes are played and how they are performed. We hence dive deeper into MIDI-DDSP that helps with high-fidelity generations using an interpretable hierarchy with several degrees of granularity.",
      "published": "February 2, 2023",
      "authors": [
        {
          "author": "Anonymous",
          "authorURL": "",
          "affiliations": [
            {
              "name": "",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <body class="fixed-top-nav"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/deep-learning-blog.github.io/">ICLR Blogposts 2023 (staging)</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/deep-learning-blog.github.io/about">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/deep-learning-blog.github.io/call">call for blogposts</a> </li> <li class="nav-item "> <a class="nav-link" href="/deep-learning-blog.github.io/submitting">submitting</a> </li> <li class="nav-item "> <a class="nav-link" href="/deep-learning-blog.github.io/blog/index.html">blog</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">past iterations</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="https://iclr-blog-track.github.io/home/" target="_blank" rel="noopener noreferrer">2022</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="post distill"> <d-title> <h1>Controllable Music Generation via MIDI-DDSP</h1> <p>Recently, there has been a lot of fascinating work focusing on making music generation for a larger and more general audience. However, these models could be of great help to the artists if they can intervene into the generation process at multiple levels in order to control what notes are played and how they are performed. We hence dive deeper into MIDI-DDSP that helps with high-fidelity generations using an interpretable hierarchy with several degrees of granularity.</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#historical-background-and-motivation">Historical background and Motivation</a></div> <div><a href="#notation-used">Notation used</a></div> <div><a href="#midi-ddsp">MIDI - DDSP</a></div> <ul> <li><a href="#what-is-ddsp">What is DDSP?</a></li> </ul> <div><a href="#midi-ddsp-architecture-summary">MIDI-DDSP architecture(summary)</a></div> <div><a href="#experiments">Experiments</a></div> <div><a href="#discussion-and-conclusion">Discussion and Conclusion</a></div> </nav> </d-contents> <h2 id="historical-background-and-motivation">Historical background and Motivation</h2> <p>Early years of synthesizer: Robert Moog, an American engineer developed a synthesizer in which created and shaped sound connected by patch cords where pitch was controlled via voltage. It was popularized in the late 1960s by rock and pop acts such as the Doors, the Grateful Dead, the Rolling Stones, and the Beatles.<d-cite key="wikipedia_2023"></d-cite> During the same time, American engineer Don Bul created the Buchla Modular Electronic Music System Buchla Modular Electronic Music System in which instead of a traditional keyboard he used touchplates where depending on finger position and force voltage was transmitted. However, Moog’s Synthesizer became more accessible and marketable to musicians during 1964 and the mid-1970s. The earliest versions of synthesizers could only produce a single note at a time. Tom Oberheim, an American engineer, developed some of the early commercial polyphonic synthesizers. The first fully programmable polyphonic synthesizer, - Prophet5 was released in 1978 which used microprocessors to store sounds in patch memory. This allowed synthesisers to go from producing uncertain sounds to “a conventional set of familiar sounds.” After introduction of MIDI in 1982, synthesizer market grew dramatically<d-cite key="vail2014synthesizer"></d-cite>.</p> <h4 id="notation-used">Notation used</h4> <p>DDSP - Differentiable Digital Signal Processing <br></p> <h2 id="midi---ddsp">MIDI - DDSP</h2> <p>While generative models are function approximator and may assist the development of samples across many domains, this expressiveness comes at the expense of interaction, since users are often limited to black-box input-output mappings without access to the network’s internals.<d-cite key="wu2021midi"></d-cite>. This makes sense as we know that having access to the latent space can be very useful for the generative models. Diffusion models lack this!<br> In computer vision and speech there has been development in methods where users are allowed to interact througout the hierarchy of system making it optimize for realism and control. Whereas in music synthesis methods still lack this interaction in hierarchy of music generation. Recent research states that one can either generate full-band audio or have control of pitch, dynamics and timbre but not both.<d-cite key="hawthorne2018enabling"></d-cite> <d-cite key="wu2021midi"></d-cite>. Authors of MIDI-DDSP<d-cite key="wu2021midi"></d-cite> take inspiration from process of creating music and propose a generative model of music generation organised in a hierarchy for more realism and control. As traditional synthesizer use MIDI standard audio files, MIDI - DDSP translates note timing, pitch, and expression data into granular control of DDSP synthesiser modules.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/MIDI_intro-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/MIDI_intro-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/MIDI_intro-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/MIDI_intro.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <em>Figure 1: Hierarchy in music synthesis <d-cite key="engel2020ddsp"></d-cite></em> </div> </div> <p>It has 3 level hierarchy:notes, performance, synthesis as shown in above figure <br> Notes : Similar to how composer writes series of Notes <br> Performance : Similar to how performer articulates these notes into dynamics, and expression in music. <br> Synthesis : Similar to how the expression are then converted to audio by short-time pitch and timbre changes of the physical vibration. <br></p> <p>MIDI-DDSP can be viewed similarly to a multi-level autoencoder. I has 3 separately trainable modules (DDSP Inference, Synthesis Generator, Expression Generator)<br> <strong>DDSP Inference</strong> - The DDSP Inference module learns to make predictions about synthesis parameters from audio and then applies those learnings to resynthesized audio using an audio reconstruction loss.<br> <strong>Synthesis Generator</strong> - The Synthesis Generator module makes predictions regarding synthesis parameters based on notes and the expression qualities associated with those notes. These predictions are then iterated through the use of a reconstruction loss and an adversarial loss. <br> <strong>Expression Generator</strong> - The Expression Generator module uses autoregressive modelling to provide predictions about note expressions based on a given note sequence which is trained via teacher forcing. <br></p> <h3 id="but-what-is-ddsp">BUT what is DDSP!</h3> <p><strong>Challenges of neural audio synthesis and how DDSP overcomes it</strong> <br> As shown in below Figure 1(left) shows that strided convolution models generate waveform with overlapping frames and suffer from phase alignment problem. Here phase alignment comes from recording of the same source made with 2 or mics placed at different distance. This distance variation cause the sound to arrive at mics at slightly different times. Figure 1(center) shows spectral leakage which occurs when the Fourier basis frequencies do not completely match the audio, where sinusoids at several nearby frequencies and phases need to be blended to represent a single sinusoid. Although the three waveforms on the right side of Figure 1 appear to have the same sound (a relative phase offset of the harmonics), an autoregressive model would find them to have very different losses. This represent inefficiency of model such that waveform shape does not correspond to perception.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/challenges-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/challenges-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/challenges-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/challenges.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <em>Figure 3: Challenges in neural audio synthesis <d-cite key="engel2020ddsp"></d-cite></em> </div> </div> <p>DDSP model overcomes above challenge and gain an advantage from the inductive bias of using oscillators while preserving the expressive power of neural networks and end-to-end training.</p> <d-cite key="engel2020ddsp"></d-cite> <p><strong>Why making the synthesis differentiable is important?</strong> The harmonics-plus-noise model, a differentiable additive synthesis model, generates audio in the paper. A sinusoids-plus-noise model version. The harmonics-plus-noise model is a synthesiser, but it requires specifying each harmonic’s amplitude and the filter’s frequency response. The harmonics plus-noise synthesiser accurately recreates actual instrument sounds, but its complex synthesis settings prevent direct engagement.<d-cite key="masuda2021synthesizer"></d-cite></p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/ddsp.gif-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/ddsp.gif-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/ddsp.gif-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/ddsp.gif" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <em> Figure 4:Decomposition of a clip of solo violin.</em> </div> </div> <p>As seen in above animation, the signals for loudness and fundamental frequency are taken from the original audio. As a result of the impacts of the room acoustics, the loudness curve does not reveal clearly differentiated note segmentations. These conditioning signals are input into the DDSP autoencoder, which then makes predictions about amplitudes, harmonic distributions, and noise magnitudes. The entire resynthesis audio is produced by applying the extracted impulse response to the synthesiser audio.</p> <p>3 main design components: <strong>Expressive</strong> - due to more params in the synthesizer (also the ability to control the generation process) <strong>Interpretable</strong> - because of the harmonic oscillator assumption i.e. relying upon fundamental frequency and loudness <strong>Adaptable</strong> - interpolation between different instruments</p> <h2 id="midi-ddsp-architecturesummary">MIDI-DDSP architecture(summary)</h2> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/hierachy_generation-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/hierachy_generation-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/hierachy_generation-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/hierachy_generation.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <em>Figure 2: MIDI-DDSP modules <d-cite key="engel2020ddsp"></d-cite></em> </div> </div> <p>This figure gives a high level view of the MIDI-DDSP modules. We also show that full-stack automatic music generation is possible when MIDI-DDSP is combined with a pretrained note generating model.</p> <h3 id="expression-generator">Expression Generator</h3> <p>Expression Generator is mainly an autoregressive RNN that is trained to predict “expression controls” from the note sequence. These are the synthesis parameters that will be used in the next network; the synthesis generator.</p> <p>So what are these Expression Controls that we speak of, you might ask! These controls also represents few of the choices that the performer makes while performing a composed track. Following is the list of controls applied:</p> <p><em>Volume</em>: Controls how loud a note is. <em>Volume fluctuation</em>: Controls how the loudness of a note changes over the note. <em>Volume peak position</em>: Controls the location of the peak volume during the course of a note. <em>Vibrato</em>: Controls the degree of a note’s vibrato, where Vibrato is a musical effect or a technique where a note changes pitch subtly and quickly <em>Brightness</em>: increases in value produce louder high-frequency harmonics, which in turn controls the timbre of the note. <em>Attack Noise</em>: Controls the amount of noise at the note’s beginning.</p> <h3 id="synthesis-generator">Synthesis Generator</h3> <p>Synthesis Generator again is an autoregressive RNN used to predict fundamental frequency, given a conditioning sequence from the previous module. It might now sound obvious that these params are in turn used in the next module, which is the DDSP Inference.</p> <h3 id="interaction-with-ddsp-interface">Interaction with DDSP interface</h3> <p>⇒ How is this different from DDSP? CNN is utilised on a logarithmic scale. Mel-spectrograms aid models in obtaining more data from audio input, enabling more precise estimation of synthesis parameter. A fully linked network is used on fundamental frequency and loudness in our DDSP inference module. In order to extract contextual information, the output is concatenated with the CNN output and sent to the bi-directional LSTM. To map the characteristics to the synthesis settings, another fully connected layer is utilised.</p> <h2 id="experiments">Experiments</h2> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/Results1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/Results1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/Results1-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/Results1.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <em>Comparison of reconstruction audio accuracy<d-cite key="wu2021midi"></d-cite></em> </div> </div> <p>As Shown in above figure in left there is comparison of Mel spectrogram of synthesis results and on right it shows comparison of synthesis quality from listening test. From figure(right) it is seen that MIDI-DDSP inference is perceived as likely as ground truth compared to other methods such as MIDI2Params, Ableton and FluidSynth.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/Results-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/Results-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/Results-1400.webp"></source> <img src="/deep-learning-blog.github.io/assets/img/2023-02-02-controllable-music-generation-via-midi-ddsp/Results.png" class="img-fluid" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Above figure shows pearson correlation between the input control and the respective output quantity. It is seen that there is strong correlation between input control and note expression output.</p> <h2 id="future-direction">Future direction</h2> <p>Author mentions in paper that one promising direction for future research is to apply this method to polyphonic recordings by means of multi-instrument transcription and multi-pitch tracking. When making differentiable it goes through many combinations and the model explore all the different possibilities and backpropagate through the soft weighting of all those possible paths, which can very soon become intractable and Reinforcement Learning could possibly be used for this search(as it is a combinatorial problem-&gt;additive synthesis).</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> </div> <d-bibliography src="/deep-learning-blog.github.io/assets/bibliography/2023-02-02-controllable-music-generation-via-midi-ddsp.bib"></d-bibliography> <script src="https://utteranc.es/client.js" repo="iclr-blogposts/2023" issue-term="pathname" theme="github-light" crossorigin="anonymous" async> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> </body> </html>